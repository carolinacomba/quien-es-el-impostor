<div class="min-h-screen bg-slate-900 text-slate-100 font-sans selection:bg-pink-500 selection:text-white pb-10">
  
  <!-- HEADER -->
  <header class="relative p-6 text-center border-b border-slate-800 bg-slate-950/50 backdrop-blur-md sticky top-0 z-10 shadow-lg shadow-purple-900/10">
        <h1 class="text-4xl font-black tracking-tighter bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 bg-clip-text text-transparent drop-shadow-sm uppercase italic">
          Qui√©n es el Chanta
        </h1>
  </header>

  <main class="max-w-md mx-auto p-4 mt-4">

    <!-- VISTA 1: CONFIGURACI√ìN (SETUP) -->
    <div *ngIf="gameState() === 'SETUP'" class="animate-fade-in space-y-6">
      
      <div class="bg-slate-800/50 relative p-6 rounded-2xl border border-slate-700 shadow-xl backdrop-blur-sm">
        <h2 class="text-xl font-bold mb-4 text-cyan-400 flex items-center gap-2">
          <span class="text-2xl">‚öôÔ∏è</span> Configuraci√≥n
        </h2>
        <button (click)="openRules()" aria-label="Reglas" class="absolute top-3 right-3 p-2 rounded-full bg-cyan-600 hover:bg-cyan-500 text-white shadow-md focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-11.5a.75.75 0 10-1.5 0v1a.75.75 0 001.5 0v-1zM9.25 9.5a.75.75 0 011.5 0v5a.75.75 0 01-1.5 0v-5z" clip-rule="evenodd" />
          </svg>
        </button>

        <!-- Input Jugadores -->
        <div class="space-y-4">
          <div>
            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Agregar Jugador</label>
            <div class="flex gap-2">
              <input 
                type="text" 
                [(ngModel)]="newPlayerName" 
                  (keyup.enter)="addPlayer()"
                    placeholder="Nombre del jugador" 
                class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-all placeholder:text-slate-600 text-lg"
              />
              <button (click)="addPlayer()" class="bg-cyan-600 hover:bg-cyan-500 text-white rounded-xl px-4 transition-colors font-bold text-xl">+</button>
            </div>

            <!-- Mensaje de Error -->
            <p *ngIf="errorMessage()" class="text-red-400 text-center text-sm font-semibold animate-pulse mt-2">
              {{ errorMessage() }}
            </p>
          </div>

          <!-- Lista Jugadores -->
          <div class="flex flex-wrap gap-2 mt-2">
            <span *ngFor="let player of players()" class="bg-slate-700 text-slate-200 px-3 py-1 rounded-full text-sm flex items-center gap-2 border border-slate-600 animate-pop-in">
              {{ player.name }}
              <button (click)="removePlayer(player.id)" class="text-slate-400 hover:text-red-400 font-bold">√ó</button>
            </span>
            <span *ngIf="players().length === 0" class="text-slate-600 text-sm italic w-full text-center py-2">
              No hay nadie todav√≠a. ¬øQui√©n juega?
            </span>
          </div>
        </div>
      </div>

      <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700 shadow-xl backdrop-blur-sm space-y-6">
        
        <!-- Selector de Impostores (+/-) -->
        <div class="flex items-center justify-between">
          <label class="text-sm font-bold text-slate-300">Cantidad de Impostores</label>
          <div class="flex items-center gap-3 bg-slate-900 rounded-lg p-1 border border-slate-700">
            <button 
              (click)="decreaseImpostors()"
              [disabled]="impostorCount() <= 1"
              class="w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-slate-700 text-cyan-400 rounded-md transition-colors disabled:opacity-30 disabled:cursor-not-allowed font-bold text-xl active:scale-95"
            >-</button>
            <span class="font-mono text-pink-400 font-bold text-xl w-6 text-center">{{ impostorCount() }}</span>
            <button 
              (click)="increaseImpostors()"
              [disabled]="impostorCount() >= maxImpostors()"
              class="w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-slate-700 text-cyan-400 rounded-md transition-colors disabled:opacity-30 disabled:cursor-not-allowed font-bold text-xl active:scale-95"
            >+</button>
          </div>
        </div>

        <!-- Toggle Categor√≠a -->
        <div class="flex items-center justify-between p-3 bg-slate-900/50 rounded-xl border border-slate-700/50 cursor-pointer" (click)="toggleCategory()">
          <span class="text-sm font-bold text-slate-300">Mostrar categor√≠a de la palabra</span>
          <div class="w-12 h-6 rounded-full p-1 transition-colors duration-300 relative" [ngClass]="showCategory() ? 'bg-green-500' : 'bg-slate-600'">
            <div class="w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300" [ngClass]="showCategory() ? 'translate-x-6' : 'translate-x-0'"></div>
          </div>
        </div>

        <!-- Toggle M√∫ltiples Impostores ven a sus compa√±eros -->
        <div *ngIf="impostorCount() >= 2" class="flex items-center justify-between p-3 bg-purple-900/30 rounded-xl border border-purple-700/50 cursor-pointer" (click)="toggleMultipleImpostors()">
          <span class="text-sm font-bold text-purple-300">Impostores ven a sus compa√±eros</span>
          <div class="w-12 h-6 rounded-full p-1 transition-colors duration-300 relative" [ngClass]="showMultipleImpostors() ? 'bg-purple-500' : 'bg-slate-600'">
            <div class="w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300" [ngClass]="showMultipleImpostors() ? 'translate-x-6' : 'translate-x-0'"></div>
          </div>
        </div>

        <!-- Toggle Pista para Impostores -->
        <div class="flex items-center justify-between p-3 bg-amber-900/30 rounded-xl border border-amber-700/50 cursor-pointer" (click)="toggleImpostorHint()">
          <span class="text-sm font-bold text-amber-300">Dar pista al impostor</span>
          <div class="w-12 h-6 rounded-full p-1 transition-colors duration-300 relative" [ngClass]="showImpostorHint() ? 'bg-amber-500' : 'bg-slate-600'">
            <div class="w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-300" [ngClass]="showImpostorHint() ? 'translate-x-6' : 'translate-x-0'"></div>
          </div>
        </div>

      </div>

      <!-- Bot√≥n Iniciar -->
      <button 
        (click)="startGame()" 
        [disabled]="!canStart()"
        class="w-full py-4 rounded-xl font-black text-lg uppercase tracking-widest transition-all transform active:scale-95 shadow-lg relative overflow-hidden group disabled:opacity-50 disabled:cursor-not-allowed"
        [ngClass]="canStart() ? 'bg-gradient-to-r from-pink-600 to-purple-600 text-white hover:shadow-purple-500/25' : 'bg-slate-800 text-slate-500'"
      >
        <span class="relative z-10">Arrancar la Partida</span>
        <div class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
      </button>

    </div>

    <!-- VISTA 2: REVELAR ROLES (GRID) -->
    <div *ngIf="gameState() === 'REVEAL_PHASE'" class="animate-fade-in">
      <h2 class="text-center text-xl text-slate-300 mb-6 font-light">
        Toc√° tu nombre para ver tu secreto. <br>
        <span class="text-xs text-slate-500 font-bold uppercase tracking-widest">¬°Que no te esp√≠en!</span>
      </h2>

      <div class="grid grid-cols-2 gap-4">
        <button 
          *ngFor="let player of players()" 
          (click)="openRevealModal(player)"
          [disabled]="player.hasSeenRole"
          class="relative h-24 rounded-2xl border-2 transition-all duration-300 flex items-center justify-center flex-col gap-2 group overflow-hidden"
          [ngClass]="player.hasSeenRole 
            ? 'bg-slate-900 border-slate-800 text-slate-600 opacity-60 scale-95' 
            : 'bg-slate-800 border-slate-600 hover:border-cyan-500 hover:bg-slate-750 text-white shadow-lg'"
        >
          <div class="z-10 font-bold text-lg truncate w-full px-2 text-center">{{ player.name }}</div>
          <div *ngIf="player.hasSeenRole" class="text-xs font-mono text-green-500 uppercase flex items-center gap-1">
            <span>‚úì</span> Listo
          </div>
          <div *ngIf="!player.hasSeenRole" class="absolute inset-0 bg-gradient-to-br from-transparent to-cyan-500/10 group-hover:to-cyan-500/20 transition-all"></div>
        </button>
      </div>

      <div class="mt-8 text-center text-slate-500 text-sm animate-pulse">
        Esperando que todos lean...
      </div>
    </div>

    <!-- VISTA 3: JUGANDO (PLAYING) -->
    <div *ngIf="gameState() === 'PLAYING'" class="animate-fade-in text-center space-y-8 mt-10">
      
      <!-- Qui√©n arranca -->
      <div class="bg-gradient-to-b from-slate-800 to-slate-900 p-8 rounded-3xl border border-slate-700 shadow-2xl relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-50"></div>
        
        <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2">Empieza</p>
        <h3 class="text-4xl font-black text-white drop-shadow-lg mb-6">{{ startingPlayerName() }}</h3>

        <div class="flex items-center justify-center gap-4 bg-slate-950/50 py-3 px-6 rounded-full inline-flex border border-slate-800">
          <span class="text-2xl">{{ directionIcon() }}</span>
          <div class="text-left">
            <p class="text-[10px] text-slate-500 uppercase font-bold">Sentido</p>
            <p class="font-bold text-cyan-400">{{ roundDirection() }}</p>
          </div>
        </div>
      </div>

      <div class="p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl text-yellow-200 text-sm">
        <p>
          <strong>Objetivo:</strong>
          {{ impostorsList().length === 1 ? 'Descubrir al impostor' : 'Descubrir a los impostores' }}
          sin revelar la palabra secreta.
        </p>
      </div>

      <div class="relative">
        <button *ngIf="revealCountdown() === 0"
          (click)="startRevealCountdown()"
          class="w-full py-4 bg-red-600 hover:bg-red-500 text-white rounded-xl font-bold text-lg shadow-lg shadow-red-900/20 transition-all active:scale-95 border-b-4 border-red-800 hover:border-red-700 top-0 active:border-b-0 active:translate-y-1"
        >
          Revelar resultados
        </button>

        <div *ngIf="revealCountdown() > 0" class="w-full py-8 bg-gradient-to-r from-red-700 to-pink-600 text-white rounded-xl font-extrabold text-5xl flex flex-col items-center justify-center space-y-2 animate-pulse">
          <div class="text-sm uppercase tracking-widest text-red-100/80">Revelando en</div>
          <div class="countdown-number">{{ revealCountdown() }}</div>
        </div>
      </div>
    </div>

    <!-- VISTA 4: RESULTADOS (RESULTS) -->
    <div *ngIf="gameState() === 'RESULTS'" class="animate-fade-in space-y-6">
      
      <!-- Palabra Revelada -->
      <div class="text-center p-6 bg-slate-800 rounded-2xl border border-slate-700 relative overflow-hidden">
        <div class="absolute -top-10 -right-10 w-32 h-32 bg-cyan-500/20 rounded-full blur-3xl"></div>
        <p class="text-slate-400 uppercase text-xs font-bold tracking-widest mb-1">La palabra era</p>
        <h2 class="text-4xl font-black text-white mb-2">{{ currentSecretWord() }}</h2>
        <span class="px-3 py-1 bg-slate-700 rounded-full text-xs text-slate-300 border border-slate-600">{{ currentCategory() }}</span>
      </div>

      <!-- Lista de Impostores -->
      <div class="bg-red-950/30 border border-red-900/50 rounded-2xl p-6">
          <h3 class="text-red-500 font-bold uppercase tracking-widest text-sm mb-4 flex items-center gap-2">
              <span>üïµÔ∏è</span>
              {{ impostorsList().length === 1 ? 'El impostor era' : 'Los impostores eran' }}
            </h3>
        <ul class="space-y-2">
          <li *ngFor="let imp of impostorsList()" class="flex items-center gap-3 text-lg font-bold text-white bg-red-900/20 p-3 rounded-lg border border-red-900/30">
            <span class="text-2xl">üë∫</span> {{ imp.name }}
          </li>
        </ul>
      </div>

      <!-- Bot√≥n Reset -->
      <button 
        (click)="resetGame()"
        class="w-full py-4 bg-cyan-600 hover:bg-cyan-500 text-white rounded-xl font-bold text-lg shadow-lg transition-all active:scale-95 uppercase tracking-wide"
      >
        Jugar otra ronda
      </button>
    </div>

  </main>

  <!-- MODAL REVELAR PALABRA -->
  <div *ngIf="isModalOpen" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 backdrop-blur-sm animate-fade-in">
    <div class="bg-slate-900 border border-slate-700 w-full max-w-sm rounded-3xl p-6 shadow-2xl relative overflow-hidden">
      
      <!-- Decoraci√≥n fondo -->
      <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500"></div>

      <div class="text-center space-y-6">
        <h3 class="text-2xl font-bold text-white">Hola, <span class="text-cyan-400">{{ currentPlayerReviewing?.name }}</span></h3>
        
        <div class="relative group cursor-pointer" (mousedown)="revealSecret()" (touchstart)="revealSecret()" (mouseup)="hideSecret()" (touchend)="hideSecret()" (mouseleave)="hideSecret()">
          
          <!-- Estado Oculto -->
          <div *ngIf="!isRevealingSecret" class="flex flex-col items-center justify-center transition-opacity duration-200 py-8">
            <p class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">Manten√© apretado para ver</p>
            <div class="w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center border border-slate-600 group-hover:border-cyan-500 group-hover:scale-110 transition-all">
              <span class="text-4xl">üëÅÔ∏è</span>
            </div>
            <p class="text-[10px] text-slate-600 mt-3">(Asegurate que nadie mire)</p>
          </div>

          <!-- Estado Revelado -->
          <div *ngIf="isRevealingSecret" class="animate-zoom-in py-8 flex flex-col items-center">
            <ng-container *ngIf="currentPlayerReviewing?.isImpostor; else innocentView">
              <p class="text-slate-400 text-xs font-bold uppercase mb-4" *ngIf="showCategory()">Categor√≠a: {{ currentCategory() }}</p>
              <h2 class="text-3xl font-black text-red-500 mb-6 glitch-text text-center">¬°SOS EL IMPOSTOR!</h2>
              <div class="w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center border border-slate-600">
                <span class="text-4xl">üëÅÔ∏è</span>
              </div>
              <p class="text-slate-300 text-sm mt-4">Disimul√°, escuch√° y ment√≠.</p>

              <!-- Mostrar pista si est√° habilitada -->
              <div *ngIf="showImpostorHint() && currentImpostorHint()" class="mt-6 p-4 bg-amber-900/30 border border-amber-700/50 rounded-lg w-full">
                <p class="text-amber-400 text-xs font-bold uppercase mb-2">üí° Pista:</p>
                <p class="text-amber-100 text-sm font-semibold">{{ currentImpostorHint() }}</p>
              </div>

              <!-- Mostrar compa√±eros impostores si es m√∫ltiple y est√° habilitado -->
              <div *ngIf="showMultipleImpostors() && impostorsList().length > 1" class="mt-8 pt-6 border-t border-slate-700 w-full">
                <p class="text-purple-400 text-xs font-bold uppercase mb-3">Tus compa√±eros impostores:</p>
                <div class="space-y-2">
                  <div *ngFor="let impostor of impostorsList()" [ngClass]="impostor.id === currentPlayerReviewing?.id ? 'hidden' : 'block'" class="bg-purple-900/30 border border-purple-700/50 rounded-lg px-3 py-2 text-white font-semibold text-sm flex items-center gap-2">
                    <span>üë∫</span> {{ impostor.name }}
                  </div>
                  <p *ngIf="impostorsList().length === 1" class="text-slate-500 text-xs italic">Solo el impostor eres vos.</p>
                </div>
              </div>
            </ng-container>
            <ng-template #innocentView>
              <p class="text-slate-400 text-xs font-bold uppercase mb-4" *ngIf="showCategory()">Categor√≠a: {{ currentCategory() }}</p>
              <h2 class="text-5xl font-black text-white mb-6 break-words min-h-24 flex items-center justify-center text-center">{{ currentSecretWord() }}</h2>
              <div class="w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center border border-slate-600">
                <span class="text-4xl">üëÅÔ∏è</span>
              </div>
              <p class="text-slate-500 text-xs mt-4">No digas la palabra, describila sutilmente.</p>
            </ng-template>
          </div>
        </div>

        <button *ngIf="!isRevealingSecret"
          (click)="closeModal()"
          [disabled]="!hasRevealedSecretOnce"
          class="w-full py-3 rounded-xl font-bold border transition-all duration-300"
          [ngClass]="hasRevealedSecretOnce 
            ? 'bg-slate-800 hover:bg-slate-700 text-white border-slate-600 shadow-lg' 
            : 'bg-slate-900 text-slate-600 border-slate-800 cursor-not-allowed opacity-50'"
        >
          {{ hasRevealedSecretOnce ? 'Listo, ya vi' : 'Primero mir√° tu palabra' }}
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL REGLAS -->
  <div *ngIf="rulesModalOpen()" class="fixed inset-0 z-60 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
    <div class="bg-slate-900 border border-slate-700 w-full max-w-lg rounded-3xl p-6 shadow-2xl relative max-h-[90vh] overflow-y-auto">
      <button (click)="closeRules()" class="absolute top-4 right-4 text-slate-400 hover:text-white">‚úï</button>
      <h2 class="text-2xl font-bold text-white mb-6">Reglas del juego</h2>
      
      <!-- Objetivo del juego -->
      <div class="mb-8">
        <h3 class="text-lg font-bold text-cyan-400 mb-3 flex items-center gap-2">
          <span>üéÆ</span> Objetivo
        </h3>
        <p class="text-slate-300 text-sm leading-relaxed">
          Los jugadores deben descubrir qui√©n es el impostor sin revelar la palabra secreta. El impostor debe disimular sin conocer la palabra.
        </p>
      </div>

      <!-- C√≥mo jugar -->
      <div class="mb-8">
        <h3 class="text-lg font-bold text-cyan-400 mb-3 flex items-center gap-2">
          <span>üìã</span> C√≥mo jugar
        </h3>
        <ol class="text-slate-300 text-sm space-y-2">
          <li class="flex gap-3"><span class="font-bold text-pink-400 min-w-fit">1.</span> <span>Agregar al menos 3 jugadores.</span></li>
          <li class="flex gap-3"><span class="font-bold text-pink-400 min-w-fit">2.</span> <span>Cada jugador toca su nombre para ver su rol en secreto.</span></li>
          <li class="flex gap-3"><span class="font-bold text-pink-400 min-w-fit">3.</span> <span>Mant√©n apretado el ojo para revelar la palabra secreta.</span></li>
          <li class="flex gap-3"><span class="font-bold text-pink-400 min-w-fit">4.</span> <span>Describe la palabra sin decirla directamente.</span></li>
          <li class="flex gap-3"><span class="font-bold text-pink-400 min-w-fit">5.</span> <span>Al terminar, se revelan los impostores.</span></li>
        </ol>
      </div>

      <!-- Opciones de configuraci√≥n -->
      <div class="mb-8">
        <h3 class="text-lg font-bold text-purple-400 mb-3 flex items-center gap-2">
          <span>‚öôÔ∏è</span> Opciones
        </h3>
        <div class="space-y-4">
          <!-- Mostrar Categor√≠a -->
          <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700">
            <p class="font-semibold text-slate-200 mb-1 flex items-center gap-2">
              <span>üìÇ</span> Mostrar categor√≠a de la palabra
            </p>
            <p class="text-slate-400 text-xs leading-relaxed">
              Si est√° habilitado, todos ver√°n la categor√≠a (ej: Pel√≠culas, Lugares, Animales). √ötil como ayuda extra.
            </p>
          </div>
          
          <!-- Impostores ven compa√±eros -->
          <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700">
            <p class="font-semibold text-slate-200 mb-1 flex items-center gap-2">
              <span>üë∫</span> Impostores ven a sus compa√±eros
            </p>
            <p class="text-slate-400 text-xs leading-relaxed">
              Solo disponible con 2 o m√°s impostores. Si est√° habilitado, cada impostor ver√° qui√©nes son los otros impostores.
            </p>
          </div>

          <!-- Pista para Impostores -->
          <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700">
            <p class="font-semibold text-slate-200 mb-1 flex items-center gap-2">
              <span>üí°</span> Dar pista al impostor
            </p>
            <p class="text-slate-400 text-xs leading-relaxed">
              Si est√° habilitado, el impostor recibir√° una pista que lo ayude a identificar la palabra sin ser obvia (ej: cantidad de letras, n√∫mero de palabras, etc).
            </p>
          </div>
        </div>
      </div>

      <div class="mt-6 text-right">
        <button (click)="closeRules()" class="px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-bold">Entendido</button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="mt-12 text-center pb-6 text-slate-500 text-xs font-light tracking-widest">
    <p>Hecho con <span class="text-pink-500">‚ô•</span> por Carolina Comba, 2025</p>
  </footer>

</div>
